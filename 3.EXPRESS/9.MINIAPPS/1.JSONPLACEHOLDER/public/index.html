<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./index.css" />
</head>

<body>
    <div id="total_container">
        <div id="main_container">
            <h1>CRUD Test</h1>

            <div class="sub_container">
                <h2>1.Get All (전체 조회)</h2>
                <button id="get_all">Get All</button>
            </div>

            <div class="sub_container">
                <h2>2.Get One (단건 조회)</h2>
                <div class="input_container">
                    <label for="post_id">ID:</label>
                    <input id="post_id" type="number" placeholder="게시글 번호" />
                    <button id="get_post">Get One</button>
                </div>
            </div>

            <div class="sub_container">
                <h2>3.Create (생성)</h2>
                <div class="textarea_container">
                    <label for="create_post_title">Title:</label>
                    <textarea id="create_post_title" placeholder="등록할 제목"></textarea>
                </div>
                <div class="textarea_container">
                    <label for="create_post_content">Body:</label>
                    <textarea id="create_post_content" placeholder="등록할 내용"></textarea>
                </div>
                <div class="input_container">
                    <button id="create_post">Create</button>
                </div>
            </div>


            <div class="sub_container">
                <h2>4.Update (수정 - PUT)</h2>
                <div class="input_container">
                    <label for="update_post_id">ID:</label>
                    <input id="update_post_id" type="number" placeholder="게시글 번호" /><br />
                </div>
                <div class="textarea_container">
                    <label for="update_post_title">Title:</label>
                    <textarea id="update_post_title" placeholder="수정할 제목"></textarea><br />
                </div>
                <div class="textarea_container">
                    <label for="update_post_content">Body:</label>
                    <textarea id="update_post_content" placeholder="수정할 내용"></textarea><br />
                </div>
                <div class="input_container">
                    <button id="update_post">Update</button>
                </div>
            </div>

            <div class="sub_container">
                <h2>5.Delete (삭제)</h2>
                <div class="input_container">
                    <label for="delete_post_id">ID:</label>
                    <input id="delete_post_id" type="number" placeholder="게시글 번호" /><br />
                    <button id="delete_post">Delete</button>
                </div>
            </div>

            <h2>Response/Output</h2>
            <div id="result">

            </div>
        </div>
    </div>

</body>
<script>
    const resultDiv = document.getElementById('result');
    const postIdInput = document.getElementById('post_id');

    const createTitleTextarea = document.getElementById('create_post_title');
    const createContentTextarea = document.getElementById('create_post_content');

    const updatePostIdInput = document.getElementById('update_post_id');
    const updatePostTitleTextarea = document.getElementById('update_post_title');
    const updatePostContentTextarea = document.getElementById('update_post_content');

    const deletePostIdInput = document.getElementById('delete_post_id');

    document.getElementById('get_all').addEventListener('click', async () => {
        try {
            const response = await fetch(`/api/posts`);
            const data = await response.json();
            console.log(data);

            let responseString = '';
            if (data.status == 'error') {
                responseString += `${data.message}`;
                resultDiv.classList.add('red_text');
            } else {
                data.message.forEach((one) => {
                    responseString += `<div class='post'>`;
                    responseString += `<p><strong>아이디: </strong> ${one.id}</p>`;
                    responseString += `<p><strong>타이틀: </strong> ${one.title}</p>`;
                    responseString += `<p><strong>바디: </strong> ${one.body}</p>`;
                    responseString += `</div>`;
                });
                resultDiv.classList.remove('red_text');
            }

            resultDiv.innerHTML = responseString;

        } catch (err) {
            console.log(err);
        }
    });

    document.getElementById('get_post').addEventListener('click', async () => {
        const postId = postIdInput.value;
        try {
            const response = await fetch(`/api/post/${postId}`);
            const data = await response.json();
            console.log(data);

            let responseString = '';
            if (data.status == 'error') {
                responseString += `${data.message}`;
                resultDiv.classList.add('red_text');
            } else {
                responseString += `<div class='post'>`;
                responseString += `<p><strong>아이디: </strong> ${data.message.id}</p>`;
                responseString += `<p><strong>타이틀: </strong> ${data.message.title}</p>`;
                responseString += `<p><strong>바디: </strong> ${data.message.body}</p>`;
                responseString += `</div>`;
                resultDiv.classList.remove('red_text');
            }

            resultDiv.innerHTML = responseString;

        } catch (err) {
            console.log(err);
        }
    });


    document.getElementById('create_post').addEventListener('click', async () => {
        const createTitle = createTitleTextarea.value;
        const createContent = createContentTextarea.value;
        const createPost = {
            title: createTitle,
            body: createContent,
        }

        console.log(createPost);
        try {
            const response = await fetch(`/api/post`, {
                method: 'POST',
                body: JSON.stringify(createPost),
                headers: {
                    'Content-type': 'application/json; charset=UTF-8',
                }
            });
            const data = await response.json();
            console.log(data);

            let responseString = '';
            responseString = data.message;

            if (data.status == 'error') {
                resultDiv.classList.add('red_text');
            } else {
                resultDiv.classList.remove('red_text');
            }
            resultDiv.innerHTML = responseString;

        } catch (err) {
            console.log(err);
        }

    });

    document.getElementById('update_post').addEventListener('click', async () => {
        const updatePostId = updatePostIdInput.value;
        const updatePostTitle = updatePostTitleTextarea.value;
        const updatePostContent = updatePostContentTextarea.value;

        const updatePost = {
            title: updatePostTitle,
            body: updatePostContent,
        }

        try {
            const response = await fetch(`/api/post/${updatePostId}`, {
                method: 'PUT',
                body: JSON.stringify(updatePost),
                headers: {
                    'Content-type': 'application/json; charset=UTF-8',
                }
            });
            const data = await response.json();
            console.log(data);

            let responseString = '';
            responseString = data.message;

            if (data.status == 'error') {
                resultDiv.classList.add('red_text');
            } else {
                resultDiv.classList.remove('red_text');
            }
            resultDiv.innerHTML = responseString;

        } catch (err) {
            console.log(err);
        }
    });

    document.getElementById('delete_post').addEventListener('click', async () => {
        const deletePostId = deletePostIdInput.value;
        try {
            const response = await fetch(`/api/post/${deletePostId}`, {
                method: 'DELETE',
            });
            const data = await response.json();
            console.log(data);

            let responseString = '';
            responseString = data.message;

            if (data.status == 'error') {
                resultDiv.classList.add('red_text');
            } else {
                resultDiv.classList.remove('red_text');
            }
            resultDiv.innerHTML = responseString;

        } catch (err) {
            console.log(err);
        }
    });

</script>

</html>